"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.resolvedModulesTransformer = void 0;
const typescript_1 = __importDefault(require("typescript"));
const remap_imports_transformer_1 = require("./remap-imports-transformer");
/**
 * Remaps static/dynamic esm imports/re-exports in a source file
 * to the actual files resolved by TypeScript.
 *
 * It ignores relative targets or ones resolved to definition (.d.ts) files.
 *
 */
function resolvedModulesTransformer(context) {
    return (sourceFile) => sourceFile.resolvedModules
        ? remap_imports_transformer_1.remapSourceFileImports(sourceFile, context, remapImportsToResolvedModules)
        : sourceFile;
}
exports.resolvedModulesTransformer = resolvedModulesTransformer;
function remapImportsToResolvedModules(request, _containingFile, { resolvedModules }) {
    if (!resolvedModules || request.startsWith('./') || request.startsWith('../')) {
        // relative request or no typescript mapping.
        return request;
    }
    const resolvedModule = resolvedModules.get(request);
    if (resolvedModule && resolvedModule.extension !== typescript_1.default.Extension.Dts) {
        // remap request to absolute resolved file
        return resolvedModule.resolvedFileName;
    }
    return request;
}
//# sourceMappingURL=resolved-modules-transformer.js.map